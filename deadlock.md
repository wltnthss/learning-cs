## 교착 상태

둘 이상의 프로세스가 자원을 점유하고 있는 상태에서 서로 다른 프로세스가 자원을 요구하며 무한히 기다리는 현상.

### 교착 상태 발생 조건

- 상호 배제

한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때 발생.

- 점유와 대기

자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태.

- 비선점

프로세스가 자원을 이용하는 동안 다른 프로세스의 자원을 빼앗지 못하고,

그 자원을 이용하는 프로세스의 작업이 끝나야 이용가능함.

- 원형 대기

대기 프로세스들이 순환 형태로 자원을 대기하고 있는 상태.

### 교착 상태 해결 방법

크게 예방, 회피, 검출 후 회복 세 가지 방법이 있음.

- 데드락이 발생하지 않도록 예방(prevention) 하기
- 데드락 발생 가능성을 인정하면서도 적절하게 회피(avoidance) 하기
- 데드락 발생을 허용하지만 데드락을 탐지(detection)하여, 데드락에서 회복하기

### 교착 상태 예방

- 상호 배제 조건 방지 : 한 번에 여러 프로세스가 공유 자원을 사용

현실적으로는 힘든 방법이며 추후 동기화 관련 문제 발생 가능성 多

- 점유와 대기 조건 방지 : 모든 자원을 모두 할당하거나, 아예 할당하지 못하게 사용

오랫동안 할당되는 자원을 다수 양산하므로 자원의 활용률이 낮다는 단점 존재

- 비선점 조건 방지 : 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 사용

- 순환 대기 조건 방지 : 한 쪽 방향으로만 자원을 요구하여 사용.

### 교착 상태 회피

안전 상태 : 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태

불안전 상태 : 교착 상태가 발생할 수 도 있는 상태

안전 순서열 : 안전 상태에서 프로세스들에 자원을 할당할 수 있는 순서

![image](https://github.com/wltnthss/learning-cs/assets/60785586/a3987057-3685-46bc-b0fc-dd4268850628)

처음에 컴퓨터 시스템이 열 두개의 자원을 사용하고 있다는 가정하에,

P0~P2는 프로세스이고, Max는 각 프로세스마다 최대 자원 요청량, Allocation은 현재 프로세스에 할당 중인 자원의 양, Need는 남은 필요한 자원의 양(Max-Allocation) 임.

현재 t0일 때 프로세스에 할당된 자원의 합은 5+2+2=9개 입니다. 따라서 현재 Available 자원은 12 - 9 = 3개.

여기서 Safe sequence는 순서가 <P1, P0, P2> 일 때 안전 순서를 만족.

P1은 2개가 이미 할당되어 있고, 2개를 추가적으로 할당받기를(Need) 기다리고 있음. 현재 Available 자원은 3개이므로, 이 중에 2개를 P1에게 할당해줌 => 현재 Available은 3 - 2 = 1개

실행이 끝난 P1은 자신에게 할당되어 있던 자원 4개를 모두 반납 => 현재 Available은 1 + 4 = 5개

현재 Available 자원이 5개이고, 이를 P0에게 모두 할당해 주면 P0도 실행 가능 => 현재 Available은 5 - 5 = 0개

실행이 끝난 P0은 자신에게 할당되어 있던 자원 10개를 모두 반납 => 현재 Available은 0 + 10 = 10개

마지막으로 P2에게 자원 7개를 할당 => 현재 Available은 10 - 7 = 3개

실행이 끝난 P2는 자신에게 할당되어 있던 자원 9개를 모두 반납 => 현재 Available은 3 + 9 = 12개

이렇게 자원의 부족함 없이 올바르게 할당하여 모든 프로세스가 실행 가능함.

만약 여기서 자원을 5,2,2 이 아니라 5,2,3 으로 배분했다면 P0, P2는 자원이 모자르는 상태로 계속 기다려 교착상태가 발생함.

### 교착 상태 검출 후 회복

교착 상태 발생을 인정하고 사후에 조치하는 방식.

- 선점을 통한 회복

교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식.

교착 상태가 해결될 때까지 다른 프로세스로부터 자원을 강제로 빼앗고 한 프로세스에 할당하는 방식.

- 프로세스 강제 종료를 통한 회복

교착 상태가 없어질 때까지 한 프로세스씩 강제 종료하는 방식.


