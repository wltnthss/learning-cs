## 페이지 교체와 프레임 할당

물리 메모리의 크기는 한정되어있기에, 운영체제는 한정된 메모리를 효율적으로 이용하기 위해

기존에 메모리에 적재된 불필요한 페이지를 선별하고 보조기억장치로 내보낼 수 있어야함.

즉, 프로세스들에게 적절한 수의 프레임을 할당하여 페이지를 할당할 수 있게 해주어야되는데 이를 위한 기능은 어떻게 수행되는지 알아보자. 

### 요구 페이징

프로세스를 필요한 페이지만 메모리에 적재하는 기법을 요구 페이징이라함.
(실행에 요구되는 페이지만 적재)

아무런 페이지도 메모리에 적재하지 않은 채 실행할 경우 시작부터 페이지 폴트가 발생하게되고, 

실행에 필요한 페이지가 적재된 이후부터는 페이지 폴트 발생 빈도가 적어짐.

이를 순수 요구 페이징 기법이라고함.

페이징 시스템이 안정적으로 작동하려면 페이지 교체, 프레임 할당 두 가지를 해결해야함.

요구 페이징 기법으로 페이지들을 적재하다보면 메모리가 가득 차게되는데,

이 때는 당장 실행에 필요한 페이지를 적재하기 위해 메모리에 적재된 페이지를 보조기억장치로 내보내야 함.

어떤 페이지를 내보내는 것이 최선인지에 대한 결정을 하는 것이 페이지 교체 알고리즘이라고 함.

### 페이지 교체 알고리즘

페이지 폴트를 가장 적게 일으키는 알고리즘이 좋은 알고리즘임.
(페이지 폴트가 일어나면 보조기억장치로부터 필요한 페이지를 가져와야 하기 때문)

페이지 교체 알고리즘을 사용하려면 페이지 폴트 횟수를 알야아하고 이는 페이지 참조열을 통해 알 수 있음.

ex) 2 2 2 3 5 5 5 3 3 7 -> 연속된 페이지를 생략한 페이지열 2 3 5 3 7 이 페이지 참조열임.

#### FIFO 페이지 교체 알고리즘

First-in First-out 알고리즘으로 가장 먼저 올라온 페이지부터 내쫓는 방식으로 간단한 알고리즘임.
(오래 머물렀다면 나가야함)

![image](https://github.com/wltnthss/learning-cs/assets/60785586/60c90b1d-5e5b-40e8-9b16-6976756848b0)

구현은 간단하나 성능은 좋지 않음.

#### 최적 페이지 교체 알고리즘

CPU에 의해 참조되는 횟수를 고려하는 페이지 교체 알고리즘임.
(사용 빈도가 가장 낮은 페이지를 교체하는 알고리즘)

오랫동안 사용되지 않을 페이지를 예측하는게 어려우므로, 주로 이론상 성능 평가를 위한 목적으로 쓰임.

#### LRU 페이지 교체 알고리즘

Least Recently Used Page Replacement Algorithm 임.

가장 오랫동안 사용되지 않은 페이지를 교체하는 알고리즘임.

![image](https://github.com/wltnthss/learning-cs/assets/60785586/2e61aa59-72f1-44ec-9496-dfc37f727f46)

### 스레싱과 프레임 할당

프로세스가 사용할 수 있는 프레임 수가 적어도 페이지 폴트는 자주 발생함.

프레임이 부족하면 CPU는 페이지 폴트가 자주 발생할 수 밖에 없음.

CPU가 프로세스를 지속적으로 실행해야 생산성이 오를텐데 페이지 교체에만 많은 시간을 쏟게되면 성능에도 악영향을 미침.

이처럼 프로세스가 실제 실행되는 시간보다 페이징에 더 많은 시간을 소요해서 성능이 저해되는 문제를 스래싱이라고함.

스래싱이 발생하는 근본적인 원인은 각 프로세스가 필요로 하는 최소한의 프레임 수가 보장되지 않았기 때문임.

그렇기에 운영체제는 각 프로세스들이 무리 없이 실행할 수 있는 최소한의 프레임 수를 파악하고 할당해줘야함.

가장 단순한 형태인 프레임 할당 방식부터 알아보자.

세 개의 프로세스에 총 300개 프레임을 할당한다고 하면 각 프로세스에 100개 프로세스를 할당하는 균등 할당 방식.
(프로세스마다 크기가 다르므로 비합리적인 방식)

프로세스의 크기에 비율에 맞추는 비례 할당 방식.
(막상 실행해보니 많은 프레임을 요구하지 않으므로 완벽한 방식은 아님)

프로세스를 실행하는 과정에서 배분할 프레임을 결정하는 방식은 작업 집합 모델, 페이지 폴트 빈도 두 가지 방식이 있음.

작업 집합 모델 기반 프레임 할당 방식은 프로세스가 일정 기간 동안 참조한 페이지 집합을 기억하여 빈번한 페이지 교체를 방지함.

작업 집합은 실행 중인 프로세스가 일정 시간 동안 참조한 페이지의 집함을 말함.

CPU가 과거에 주로 참조한 페이지를 작업 집함에 포함한다면 운영체제는 작업 집합의 크기만큼만 프레임을 할당하면됨.

페이지 폴트율 기반 프레임 할당은 페이지 폴트율에 상한선과 하한선을 정하고, 그 내부 범위 안에서만 프레임을 할당하는 방식임.











